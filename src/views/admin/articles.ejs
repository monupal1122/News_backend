<% const activePage='articles' ; %>
    <%- include('../partials/header') %>

        <div class="container-fluid p-0">
            <%- include('../partials/sidebar', { activePage }) %>

                <main>
                    <header class="main-header mb-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h1 class="h3 fw-bold mb-0">Article Library</h1>
                                <p class="text-muted small mb-0">Manage all your stories in one place</p>
                            </div>
                            <a href="/admin/articles/create" class="btn btn-secondary">
                                <i class="bi bi-plus-lg me-2"></i>Create New Story
                            </a>
                        </div>
                    </header>

                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                        <div
                            class="card-header bg-white py-3 border-0 d-flex justify-content-between align-items-center">
                            <div class="d-flex gap-2">
                                <button class="btn btn-light btn-sm fw-semibold px-3">All</button>
                                <button class="btn btn-white btn-sm text-muted px-3">Featured</button>
                                <button class="btn btn-white btn-sm text-muted px-3">Drafts</button>
                            </div>
                            <div class="input-group input-group-sm" style="width: 250px;">
                                <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0"
                                    placeholder="Search articles...">
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0 custom-table">
                                <thead>
                                    <tr>
                                        <th class="ps-4">Cover</th>
                                        <th>Story Details</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Engagement</th>
                                        <th class="pe-4 text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% articles.forEach(article=> { %>
                                        <tr id="row-<%= article._id %>">
                                            <td class="ps-4" style="width: 100px;">
                                                <img src="<%= article.imageUrl || 'https://via.placeholder.com/120x80?text=No+Image' %>"
                                                    class="rounded-3 shadow-sm" width="80" height="54"
                                                    style="object-fit: cover;">
                                            </td>
                                            <td>
                                                <div class="fw-bold text-slate-800">
                                                    <%= article.title %>
                                                </div>
                                                <div class="d-flex align-items-center gap-2 mt-1">
                                                    <small class="text-muted"><i class="bi bi-person me-1"></i>
                                                        <%= article.author %>
                                                    </small>
                                                    <span class="text-muted opacity-25">â€¢</span>
                                                    <small class="text-muted"><i class="bi bi-calendar3 me-1"></i>
                                                        <%= new Date(article.createdAt).toLocaleDateString() %>
                                                    </small>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-light text-dark border text-capitalize px-3">
                                                    <%= article.category ? article.category.name : 'Uncategorized' %>
                                                </span>
                                            </td>
                                            <td>
                                                <% if (article.isFeatured) { %>
                                                    <span
                                                        class="badge bg-warning bg-opacity-10 text-warning-emphasis border border-warning border-opacity-25 px-3">
                                                        <i class="bi bi-star-fill me-1"></i> Featured
                                                    </span>
                                                    <% } else { %>
                                                        <span
                                                            class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 px-3">
                                                            Standard
                                                        </span>
                                                        <% } %>
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center gap-1">
                                                    <i class="bi bi-eye text-primary"></i>
                                                    <span class="fw-semibold">
                                                        <%= article.viewCount %>
                                                    </span>
                                                </div>
                                            </td>
                                            <td class="pe-4 text-end">
                                                <div class="d-flex justify-content-end gap-2">
                                                    <a href="/admin/articles/edit/<%= article._id %>"
                                                        class="btn btn-light btn-sm rounded-3 px-3 hover-primary">
                                                        <i class="bi bi-pencil-square me-1"></i> Edit
                                                    </a>
                                                    <button onclick="deleteArticle('<%= article._id %>')"
                                                        class="btn btn-light-danger btn-sm rounded-3 px-3">
                                                        <i class="bi bi-trash-fill"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <% }) %>
                                </tbody>
                            </table>
                        </div>

                        <% if(articles.length===0) { %>
                            <div class="text-center py-5">
                                <div class="mb-3">
                                    <i class="bi bi-journal-x fs-1 text-muted opacity-25"></i>
                                </div>
                                <h5 class="fw-bold">No articles found</h5>
                                <p class="text-muted">Start by creating your first story today.</p>
                                <a href="/admin/articles/create" class="btn btn-secondary mt-2">Create Article</a>
                            </div>
                            <% } %>
                    </div>
                </main>
        </div>

        <style>
            .btn-light-danger {
                background-color: #fff1f2;
                color: #e11d48;
                border: none;
            }

            .btn-light-danger:hover {
                background-color: #ffe4e6;
                color: #be123c;
            }

            .hover-primary:hover {
                background-color: #eff6ff;
                color: #2563eb;
            }

            .text-slate-800 {
                color: #1e293b;
            }
        </style>

        <script>
            async function deleteArticle(id) {
                if (confirm('Are you sure you want to permanently delete this story?')) {
                    try {
                        const response = await fetch(`/admin/articles/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        if (response.ok) {
                            const row = document.getElementById(`row-${id}`);
                            row.style.transition = 'all 0.4s ease';
                            row.style.opacity = '0';
                            row.style.transform = 'translateX(20px)';
                            setTimeout(() => row.remove(), 400);
                        } else {
                            alert('Failed to delete story. Please try again.');
                        }
                    } catch (err) {
                        console.error(err);
                        alert('An error occurred while deleting the story.');
                    }
                }
            }
        </script>

        <%- include('../partials/footer') %>